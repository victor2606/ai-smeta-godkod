# N8N Agent Instructions: Construction Estimator MCP Tools

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 5 MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–∞—Å—Ü–µ–Ω–∫–∞–º–∏ –≤ N8N workflows. MCP —Å–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ 28,686 —Ä–∞—Å—Ü–µ–Ω–æ–∫ –∏ 294,883 —Ä–µ—Å—É—Ä—Å–æ–≤.

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MCP Server

**Endpoint:** `http://host.docker.internal:8002/sse`
**Transport:** HTTP/SSE
**Health Check:** `http://host.docker.internal:8003/health`

## –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools)

### 1. `natural_search` - –ü–æ–∏—Å–∫ —Ä–∞—Å—Ü–µ–Ω–æ–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Ä–∞—Å—Ü–µ–Ω–æ–∫ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "query": "–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω",
  "unit_type": "–º2",          // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ñ–∏–ª—å—Ç—Ä –ø–æ –µ–¥–∏–Ω–∏—Ü–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è
  "limit": 10                 // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–∞–∫—Å. –∫–æ–ª-–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10, –º–∞–∫—Å 100)
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "success": true,
  "count": 5,
  "results": [
    {
      "rate_code": "–ì–≠–°–ù–ø10-05-001-01",
      "rate_full_name": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ –∏–∑ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤...",
      "rate_short_name": "–ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –ì–ö–õ –æ–¥–Ω–æ—Å–ª–æ–π–Ω—ã–µ",
      "unit_measure_full": "100 –º2 –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫",
      "cost_per_unit": 13832.02,
      "total_cost": 13832.02,
      "rank": 0.15
    }
  ]
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å–ª–æ–≤–∞–º–∏ (–Ω–µ –∑–Ω–∞–µ—Ç –∫–æ–¥ —Ä–∞—Å—Ü–µ–Ω–∫–∏)
- –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç

**–ü—Ä–∏–º–µ—Ä N8N Node:**
```
HTTP Request Node
- Method: POST
- URL: http://host.docker.internal:8002/mcp/tool/natural_search
- Body:
  {
    "query": "{{ $json.user_query }}",
    "limit": 5
  }
```

---

### 2. `quick_calculate` - –ë—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–¥ —Ä–∞—Å—Ü–µ–Ω–∫–∏ –ò–õ–ò –æ–ø–∏—Å–∞–Ω–∏–µ

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "rate_identifier": "10-05-001-01",  // –∫–æ–¥ —Ä–∞—Å—Ü–µ–Ω–∫–∏ –ò–õ–ò –æ–ø–∏—Å–∞–Ω–∏–µ
  "quantity": 150.5                   // –æ–±—ä–µ–º —Ä–∞–±–æ—Ç (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ > 0)
}
```

**–ü—Ä–∏–º–µ—Ä—ã rate_identifier:**
- –ö–æ–¥ —Ä–∞—Å—Ü–µ–Ω–∫–∏: `"10-05-001-01"`, `"–ì–≠–°–ù–ø81-01-001"`
- –û–ø–∏—Å–∞–Ω–∏–µ: `"–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω"` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç –ª—É—á—à—É—é —Ä–∞—Å—Ü–µ–Ω–∫—É)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "success": true,
  "rate_info": {
    "rate_code": "–ì–≠–°–ù–ø10-05-001-01",
    "rate_full_name": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫...",
    "unit_type": "100 –º2 –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫"
  },
  "cost_per_unit": 13832.02,
  "calculated_total": 20800.23,
  "materials": 8500.50,
  "resources": 12299.73,
  "quantity": 150.5,
  "search_used": false
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ù—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–∞—Ç—å –∫–æ–¥ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º

**–ü—Ä–∏–º–µ—Ä N8N Workflow:**
```
1. Webhook (–ø–æ–ª—É—á–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
2. HTTP Request:
   - URL: http://host.docker.internal:8002/mcp/tool/quick_calculate
   - Body: { "rate_identifier": "{{ $json.description }}", "quantity": {{ $json.volume }} }
3. Set Node (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç)
4. Respond to Webhook
```

---

### 3. `show_rate_details` - –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ —Ä–∞—Å—Ü–µ–Ω–∫–∏

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, —Ç—Ä—É–¥—É –∏ —Ç–µ—Ö–Ω–∏–∫–µ

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "rate_code": "10-05-001-01",
  "quantity": 150.0              // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.0
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "success": true,
  "rate_info": {
    "rate_code": "–ì–≠–°–ù–ø10-05-001-01",
    "rate_full_name": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫...",
    "unit_type": "100 –º2 –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫"
  },
  "total_cost": 20748.03,
  "cost_per_unit": 13832.02,
  "materials": 12759.60,
  "resources": 7988.43,
  "quantity": 150.0,
  "breakdown": [
    {
      "resource_code": "101-1529",
      "resource_name": "–õ–∏—Å—Ç—ã –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω–Ω—ã–µ",
      "resource_type": "Material",
      "adjusted_quantity": 450.0,
      "unit": "–º2",
      "unit_cost": 25.50,
      "adjusted_cost": 11475.00
    },
    {
      "resource_code": "101-0819",
      "resource_name": "–ü—Ä–æ—Ñ–∏–ª–∏ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ",
      "resource_type": "Material",
      "adjusted_quantity": 225.0,
      "unit": "–º.–ø.",
      "unit_cost": 5.71,
      "adjusted_cost": 1284.75
    }
    // ... –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤
  ]
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ù—É–∂–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å–º–µ—Ç–∞ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º
- –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞—Ç—Ä–∞—Ç
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞

**–ü—Ä–∏–º–µ—Ä N8N Workflow —Å —Ç–∞–±–ª–∏—Ü–µ–π:**
```
1. HTTP Request (get details)
2. Split Out (—Ä–∞–∑–¥–µ–ª–∏—Ç—å breakdown –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã)
3. Google Sheets (–∑–∞–ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–µ—Å—É—Ä—Å –≤ —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã)
```

---

### 4. `compare_variants` - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞—Å—Ü–µ–Ω–æ–∫

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ä–∞–≤–Ω–∏—Ç—å 2 –∏–ª–∏ –±–æ–ª–µ–µ —Ä–∞—Å—Ü–µ–Ω–æ–∫ side-by-side

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "rate_codes": ["10-05-001-01", "10-06-037-02", "11-01-015-01"],
  "quantity": 100.0
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "success": true,
  "count": 3,
  "comparison": [
    {
      "rate_code": "10-05-001-01",
      "rate_full_name": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ –æ–¥–Ω–æ—Å–ª–æ–π–Ω—ã—Ö",
      "unit_type": "100 –º2",
      "cost_per_unit": 13832.02,
      "total_for_quantity": 13832.02,
      "materials_for_quantity": 8506.40,
      "difference_from_cheapest": 0.00,
      "difference_percent": 0.00
    },
    {
      "rate_code": "10-06-037-02",
      "rate_full_name": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ –¥–≤—É—Ö—Å–ª–æ–π–Ω—ã—Ö",
      "unit_type": "100 –º2",
      "cost_per_unit": 18450.75,
      "total_for_quantity": 18450.75,
      "materials_for_quantity": 11200.30,
      "difference_from_cheapest": 4618.73,
      "difference_percent": 33.39
    }
    // ... –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  ]
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –í—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- –ê–Ω–∞–ª–∏–∑ —ç–∫–æ–Ω–æ–º–∏–∏ –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞

**–ü—Ä–∏–º–µ—Ä N8N Decision Workflow:**
```
1. HTTP Request (compare_variants)
2. IF Node (check if difference_percent > 20%)
   - TRUE: Send notification "–î–æ—Ä–æ–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç!"
   - FALSE: Approve automatically
```

---

### 5. `find_similar_rates` - –ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ä–∞—Å—Ü–µ–Ω–æ–∫

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏ (–∞–Ω–∞–ª–æ–≥–∏) –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–π

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "rate_code": "10-05-001-01",
  "max_results": 5              // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5, –º–∞–∫—Å 20
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "success": true,
  "source_rate": "10-05-001-01",
  "count": 5,
  "alternatives": [
    {
      "rate_code": "10-05-001-01",
      "rate_full_name": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ –æ–¥–Ω–æ—Å–ª–æ–π–Ω—ã—Ö (–∏—Å—Ö–æ–¥–Ω–∞—è)",
      "unit_type": "100 –º2",
      "cost_per_unit": 13832.02,
      "total_for_quantity": 13832.02,
      "materials_for_quantity": 8506.40,
      "difference_from_cheapest": 0.00,
      "difference_percent": 0.00
    },
    {
      "rate_code": "10-05-002-01",
      "rate_full_name": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ —Å —à—É–º–æ–∏–∑–æ–ª—è—Ü–∏–µ–π",
      "unit_type": "100 –º2",
      "cost_per_unit": 15200.50,
      "total_for_quantity": 15200.50,
      "materials_for_quantity": 9800.20,
      "difference_from_cheapest": 1368.48,
      "difference_percent": 9.89
    }
    // ... –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  ]
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ–∏—Å–∫ –±–æ–ª–µ–µ –¥–µ—à–µ–≤—ã—Ö –∞–Ω–∞–ª–æ–≥–æ–≤
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–º–µ—Ç—ã

**–ü—Ä–∏–º–µ—Ä N8N Optimization Workflow:**
```
1. Loop over all rates in estimate
2. For each rate:
   - HTTP Request (find_similar_rates)
   - Filter alternatives with difference_percent < 0 (cheaper)
   - If found: Send suggestion to user
```

---

## –ì–æ—Ç–æ–≤—ã–µ N8N Workflow Patterns

### Pattern 1: –ß–∞—Ç-–±–æ—Ç –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram/Slack  ‚îÇ –ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ Trigger         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ OpenAI Node     ‚îÇ –ò–∑–≤–ª–µ—á—å: description, quantity
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ HTTP Request    ‚îÇ Tool: quick_calculate
‚îÇ (MCP)           ‚îÇ Body: { rate_identifier, quantity }
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Function Node   ‚îÇ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram/Slack  ‚îÇ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
‚îÇ Send Message    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ Function Node:**
```javascript
const result = $input.item.json;

if (result.success) {
  const message = `
üìä –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏

–†–∞—Å—Ü–µ–Ω–∫–∞: ${result.rate_info.rate_code}
–û–ø–∏—Å–∞–Ω–∏–µ: ${result.rate_info.rate_full_name}

–û–±—ä–µ–º: ${result.quantity} ${result.rate_info.unit_type}
–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –µ–¥–∏–Ω–∏—Ü—É: ${result.cost_per_unit.toFixed(2)} —Ä—É–±.

üí∞ –ò–¢–û–ì–û: ${result.calculated_total.toFixed(2)} —Ä—É–±.

–ò–∑ –Ω–∏—Ö:
üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã: ${result.materials.toFixed(2)} —Ä—É–±.
‚öôÔ∏è –†–∞–±–æ—Ç–∞ + —Ç–µ—Ö–Ω–∏–∫–∞: ${result.resources.toFixed(2)} —Ä—É–±.
  `;

  return { json: { message } };
} else {
  return { json: { message: `‚ùå –û—à–∏–±–∫–∞: ${result.error}` } };
}
```

---

### Pattern 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Webhook         ‚îÇ –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ rate_codes + quantity
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ HTTP Request    ‚îÇ Tool: compare_variants
‚îÇ (MCP)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Sort Node       ‚îÇ –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ total_for_quantity
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Function Node   ‚îÇ –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Google Sheets   ‚îÇ –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### Pattern 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–º–µ—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Google Sheets   ‚îÇ –ß–∏—Ç–∞—Ç—å –≤—Å–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏ –∏–∑ —Å–º–µ—Ç—ã
‚îÇ Read            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Loop Node       ‚îÇ –î–ª—è –∫–∞–∂–¥–æ–π —Ä–∞—Å—Ü–µ–Ω–∫–∏:
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ HTTP Request    ‚îÇ Tool: find_similar_rates
‚îÇ (MCP)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Filter Node     ‚îÇ –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –±–æ–ª–µ–µ –¥–µ—à–µ–≤—ã–µ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   (difference_from_cheapest < 0)
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ IF Node         ‚îÇ –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –±–æ–ª–µ–µ –¥–µ—à–µ–≤—ã–µ:
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         ‚îÇ
   YES       NO
    ‚îÇ         ‚îÇ
    ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Email ‚îÇ  ‚îÇ Skip  ‚îÇ
‚îÇ Alert ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### Pattern 4: –ü–æ–∏—Å–∫ + –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è + –û—Ç—á–µ—Ç

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Manual Trigger  ‚îÇ –í–≤–µ—Å—Ç–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ HTTP Request    ‚îÇ Tool: natural_search
‚îÇ (MCP)           ‚îÇ –ù–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Item Lists      ‚îÇ –í–∑—è—Ç—å –ø–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
‚îÇ (First Item)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ HTTP Request    ‚îÇ Tool: show_rate_details
‚îÇ (MCP)           ‚îÇ –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Function Node   ‚îÇ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å PDF-–æ—Ç—á–µ—Ç (HTML)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Email Node      ‚îÇ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ N8N

–í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "error": "Invalid input",
  "details": "Quantity must be greater than 0, got: -10"
}
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:**

```javascript
// Function Node –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞
const result = $input.item.json;

if (result.error) {
  // –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É
  console.error('MCP Tool Error:', result.error, result.details);

  // –í–µ—Ä–Ω—É—Ç—å –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  return {
    json: {
      success: false,
      user_message: `–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å: ${result.details}`
    }
  };
}

// –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ - –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å workflow
return { json: result };
```

**IF Node –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:**
```
Condition: {{ $json.error }} is not empty
- TRUE branch: Send error notification
- FALSE branch: Continue processing
```

---

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ N8N Cache Node –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Cache Check     ‚îÇ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à –ø–æ rate_code
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         ‚îÇ
  MISS       HIT
    ‚îÇ         ‚îÇ
    ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ MCP   ‚îÇ  ‚îÇ Return‚îÇ
‚îÇ Call  ‚îÇ  ‚îÇ Cache ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Cache ‚îÇ
‚îÇ Save  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. Batch Processing

–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ä–∞—Å—Ü–µ–Ω–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Loop Node:

```javascript
// Split Into Batches Node
{
  "batchSize": 10,  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ 10 —Ä–∞—Å—Ü–µ–Ω–æ–∫ –∑–∞ —Ä–∞–∑
  "options": {
    "reset": false  // –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏
  }
}
```

### 3. Retry –ª–æ–≥–∏–∫–∞

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTP Request Node –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫:

```json
{
  "retry": {
    "maxRetries": 3,
    "retryInterval": 1000
  },
  "timeout": 30000
}
```

### 4. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Function Node –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º MCP:

```javascript
// –í–∞–ª–∏–¥–∞—Ü–∏—è quantity
const quantity = parseFloat($json.quantity);

if (isNaN(quantity) || quantity <= 0) {
  throw new Error('Invalid quantity: must be a positive number');
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è rate_code
const rateCode = ($json.rate_code || '').trim();

if (!rateCode) {
  throw new Error('Rate code cannot be empty');
}

return {
  json: {
    rate_code: rateCode,
    quantity: quantity
  }
};
```

---

## –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö Use Cases

### Use Case 1: Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ—Ä–∞–±–æ–≤

**–ó–∞–¥–∞—á–∞:** –ü—Ä–æ—Ä–∞–± –Ω–∞ –æ–±—ä–µ–∫—Ç–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç —á–µ—Ä–µ–∑ Telegram

**Workflow:**
1. Telegram Trigger (–ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ)
2. OpenAI (–∏–∑–≤–ª–µ—á—å structured data: work_description, quantity)
3. HTTP Request ‚Üí `quick_calculate`
4. Function (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥)
5. Telegram Send Message

**–ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞:**
```
–ü—Ä–æ—Ä–∞–±: –°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –∑–∞–ª–∏—Ç—å 25 –∫—É–±–æ–≤ –±–µ—Ç–æ–Ω–∞ –ú300?

–ë–æ—Ç:
üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:

–†–∞—Å—Ü–µ–Ω–∫–∞: –ì–≠–°–ù–ø06-01-001-05
–ë–µ—Ç–æ–Ω –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –ú300

–û–±—ä–µ–º: 25 –º¬≥
–°—Ç–æ–∏–º–æ—Å—Ç—å: 125,450.50 —Ä—É–±.

üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã: 95,600.00 —Ä—É–±.
‚öôÔ∏è –†–∞–±–æ—Ç–∞: 29,850.50 —Ä—É–±.
```

---

### Use Case 2: –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–º–µ—Ç

**–ó–∞–¥–∞—á–∞:** –ï–∂–µ–Ω–æ—á–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ —Å–º–µ—Ç—ã –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —ç–∫–æ–Ω–æ–º–∏–∏

**Workflow:**
1. Schedule Trigger (–∫–∞–∂–¥—É—é –Ω–æ—á—å –≤ 3:00)
2. Google Sheets Read (–≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–º–µ—Ç—ã)
3. Loop:
   - –î–ª—è –∫–∞–∂–¥–æ–π —Ä–∞—Å—Ü–µ–Ω–∫–∏ ‚Üí `find_similar_rates`
   - Filter (—Ç–æ–ª—å–∫–æ –±–æ–ª–µ–µ –¥–µ—à–µ–≤—ã–µ –∞–Ω–∞–ª–æ–≥–∏)
   - Calc (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è)
4. Aggregate (—Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å —ç–∫–æ–Ω–æ–º–∏—é)
5. Email (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä—É)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** "–ù–∞–π–¥–µ–Ω–æ 12 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è: 245,000 —Ä—É–±."

---

### Use Case 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ö–ü –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤

**–ó–∞–¥–∞—á–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—Ü–µ–Ω–∫–∏ –æ—Ç –ø–æ–¥—Ä—è–¥—á–∏–∫–∞ –Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å

**Workflow:**
1. Email Trigger (–ø–æ–ª—É—á–∏—Ç—å –ö–ü –≤ PDF)
2. PDF Extract (–∏–∑–≤–ª–µ—á—å —Ç–∞–±–ª–∏—Ü—É —Ä–∞–±–æ—Ç)
3. Loop over rows:
   - HTTP Request ‚Üí `quick_calculate` (–¥–ª—è —Ç–æ–≥–æ –∂–µ –æ–±—ä–µ–º–∞)
   - Compare (—Ü–µ–Ω–∞ –ø–æ–¥—Ä—è–¥—á–∏–∫–∞ vs. –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
   - IF (—Ä–∞–∑–Ω–∏—Ü–∞ > 15%) ‚Üí Flag as "Overpriced"
4. Generate Report (HTML/PDF)
5. Email (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏)

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Connection timeout

**–ü—Ä–∏—á–∏–Ω–∞:** MCP —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose -f docker-compose.mcp.yml ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose -f docker-compose.mcp.yml logs -f mcp-server

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.mcp.yml restart
```

### –ü—Ä–æ–±–ª–µ–º–∞: Tool returns empty results

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ –±–∞–∑–µ
**–†–µ—à–µ–Ω–∏–µ:**
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –æ–±—â–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∏—Ä–∏–ª–ª–∏—Ü—É)

### –ü—Ä–æ–±–ª–µ–º–∞: Incorrect total cost

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `unit_type` –≤ –æ—Ç–≤–µ—Ç–µ
- –ï—Å–ª–∏ —Ä–∞—Å—Ü–µ–Ω–∫–∞ "100 –º¬≤", –∞ –Ω—É–∂–Ω–æ 150 –º¬≤, –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å quantity=150 (–Ω–µ 1.5)

---

## API Reference Summary

| Tool | Primary Use | Input | Output |
|------|-------------|-------|--------|
| `natural_search` | –ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é | query, unit_type?, limit? | List of rates |
| `quick_calculate` | –ë—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á–µ—Ç | rate_identifier, quantity | Total cost + breakdown |
| `show_rate_details` | –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–º–µ—Ç–∞ | rate_code, quantity? | Resources breakdown |
| `compare_variants` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ | rate_codes[], quantity | Comparison table |
| `find_similar_rates` | –ü–æ–∏—Å–∫ –∞–Ω–∞–ª–æ–≥–æ–≤ | rate_code, max_results? | Similar rates list |

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **MCP Server Health:** `http://host.docker.internal:8003/health`
- **Database:** 28,686 —Ä–∞—Å—Ü–µ–Ω–æ–∫, 294,883 —Ä–µ—Å—É—Ä—Å–æ–≤
- **Supported units:** –º¬≤, –º¬≥, —Ç, –º.–ø., 100 –º¬≤, 1000 —à—Ç, –∏ –¥—Ä.
- **Language:** –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-10-21
**–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ
