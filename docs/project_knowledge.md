# –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –°–º–µ—Ç–Ω—ã–π –ü–æ–∏—Å–∫ - –ë–∞–∑–∞ –ó–Ω–∞–Ω–∏–π –ü—Ä–æ–µ–∫—Ç–∞

## –û –ø—Ä–æ–µ–∫—Ç–µ

–≠—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–∞—Å—Ü–µ–Ω–∫–∞–º–∏ —Å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–º –ø–æ–∏—Å–∫–æ–º –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –ø–æ–∏—Å–∫–∞, —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—Ü–µ–Ω–æ–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ì–≠–°–ù/–§–ï–†.

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** 28,686 —Ä–∞—Å—Ü–µ–Ω–æ–∫, 294,883 —Ä–µ—Å—É—Ä—Å–æ–≤
**–†–∞–∑–º–µ—Ä –ë–î:** ~290 MB (SQLite —Å FTS5)
**–Ø–∑—ã–∫:** Python 3.x

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
n8npiplines-bim/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ database/              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î –∏ —Å—Ö–µ–º–æ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db_manager.py      # DatabaseManager - —Ä–∞–±–æ—Ç–∞ —Å SQLite
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.sql         # SQL —Å—Ö–µ–º–∞ (rates, resources, FTS5)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fts_config.py      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ search/                # –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –º–æ–¥—É–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search_engine.py   # SearchEngine - FTS5 –ø–æ–∏—Å–∫ —Ä–∞—Å—Ü–µ–Ω–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cost_calculator.py # CostCalculator - —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rate_comparator.py # RateComparator - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞—Å—Ü–µ–Ω–æ–∫
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ etl/                   # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data_aggregator.py # –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db_populator.py    # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/                 # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
‚îÇ       ‚îî‚îÄ‚îÄ agent_helpers.py   # Helper —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ raw/                   # –ò—Å—Ö–æ–¥–Ω—ã–µ Excel —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ processed/             # –ì–æ—Ç–æ–≤—ã–µ –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ estimates.db       # –û—Å–Ω–æ–≤–Ω–∞—è SQLite –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ cache/                 # –ö—ç—à –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ query_cache.json   # JSON-–∫—ç—à (TTL: 24 —á–∞—Å–∞)
‚îÇ
‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îî‚îÄ‚îÄ estimates_agent_prompt.md  # –ü—Ä–æ–º–ø—Ç –¥–ª—è Claude Code Agent
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ estimates_search_architecture.md  # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ tasks/                 # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏
‚îÇ       ‚îú‚îÄ‚îÄ active-tasks.md    # –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ       ‚îî‚îÄ‚îÄ archive/           # –ê—Ä—Ö–∏–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ build_database.py      # –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏ –ë–î –∏–∑ Excel
‚îÇ
‚îî‚îÄ‚îÄ tests/                     # Unit –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```

---

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

#### 1. `rates` (–†–∞—Å—Ü–µ–Ω–∫–∏)
–ì–ª–∞–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–∞—Å—Ü–µ–Ω–∫–∞—Ö:

```sql
CREATE TABLE rates (
    rate_code TEXT PRIMARY KEY,        -- –ö–æ–¥ —Ä–∞—Å—Ü–µ–Ω–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ì–≠–°–ù–ø81-01-001-01")
    rate_full_name TEXT NOT NULL,      -- –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
    rate_short_name TEXT,              -- –ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
    unit_quantity NUMERIC DEFAULT 1,   -- –ö–æ–ª-–≤–æ –µ–¥–∏–Ω–∏—Ü (100, 1, 1000)
    unit_type TEXT NOT NULL,           -- –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–º3, –º2, —Ç, —à—Ç)
    total_cost NUMERIC DEFAULT 0,      -- –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
    materials_cost NUMERIC DEFAULT 0,  -- –°—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
    resources_cost NUMERIC DEFAULT 0,  -- –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã + —Ç–µ—Ö–Ω–∏–∫–∞

    -- –ì–≠–°–ù/–§–ï–† –∏–µ—Ä–∞—Ä—Ö–∏—è (13 –ø–æ–ª–µ–π):
    category_type TEXT,                -- –£—Ä–æ–≤–µ–Ω—å 1: –ö–∞—Ç–µ–≥–æ—Ä–∏—è
    collection_code TEXT,              -- –£—Ä–æ–≤–µ–Ω—å 2: –°–±–æ—Ä–Ω–∏–∫ (–∫–æ–¥)
    collection_name TEXT,              -- –£—Ä–æ–≤–µ–Ω—å 2: –°–±–æ—Ä–Ω–∏–∫ (–Ω–∞–∑–≤–∞–Ω–∏–µ)
    department_code TEXT,              -- –£—Ä–æ–≤–µ–Ω—å 3: –û—Ç–¥–µ–ª (–∫–æ–¥)
    department_name TEXT,              -- –£—Ä–æ–≤–µ–Ω—å 3: –û—Ç–¥–µ–ª (–Ω–∞–∑–≤–∞–Ω–∏–µ)
    department_type TEXT,              -- –£—Ä–æ–≤–µ–Ω—å 3: –û—Ç–¥–µ–ª (—Ç–∏–ø)
    section_code TEXT,                 -- –£—Ä–æ–≤–µ–Ω—å 4: –†–∞–∑–¥–µ–ª (–∫–æ–¥)
    section_name TEXT,                 -- –£—Ä–æ–≤–µ–Ω—å 4: –†–∞–∑–¥–µ–ª (–Ω–∞–∑–≤–∞–Ω–∏–µ)
    section_type TEXT,                 -- –£—Ä–æ–≤–µ–Ω—å 4: –†–∞–∑–¥–µ–ª (—Ç–∏–ø)
    subsection_code TEXT,              -- –£—Ä–æ–≤–µ–Ω—å 5: –ü–æ–¥—Ä–∞–∑–¥–µ–ª (–∫–æ–¥)
    subsection_name TEXT,              -- –£—Ä–æ–≤–µ–Ω—å 5: –ü–æ–¥—Ä–∞–∑–¥–µ–ª (–Ω–∞–∑–≤–∞–Ω–∏–µ)
    table_code TEXT,                   -- –£—Ä–æ–≤–µ–Ω—å 6: –¢–∞–±–ª–∏—Ü–∞ (–∫–æ–¥)
    table_name TEXT,                   -- –£—Ä–æ–≤–µ–Ω—å 6: –¢–∞–±–ª–∏—Ü–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ)

    search_text TEXT,                  -- –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è –¥–ª—è FTS5
    composition TEXT,                  -- JSON —Å —Å–æ—Å—Ç–∞–≤–æ–º —Ä–∞–±–æ—Ç
    overhead_rate REAL DEFAULT 0,      -- –ù–† (–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã)
    profit_margin REAL DEFAULT 0,      -- –°–ü (–°–º–µ—Ç–Ω–∞—è –ø—Ä–∏–±—ã–ª—å)

    created_at TEXT,
    updated_at TEXT
);
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY –Ω–∞ `rate_code`
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `unit_type`, `category`, `costs`
- –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã: `collection`, `department`, `section`, `subsection`, `table`
- –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å `idx_rates_hierarchy_full` –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

#### 2. `rates_fts` (–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫)
FTS5 –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞:

```sql
CREATE VIRTUAL TABLE rates_fts USING fts5(
    rate_code,
    rate_full_name,
    rate_short_name,
    category,
    search_text,
    tokenize='unicode61 remove_diacritics 2',
    content='rates',
    content_rowid='rowid'
);
```

**–¢—Ä–∏–≥–≥–µ—Ä—ã:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ INSERT/UPDATE/DELETE –≤ `rates`

#### 3. `resources` (–†–µ—Å—É—Ä—Å—ã)
–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, —Ä–∞–±–æ—Ç–µ, —Ç–µ—Ö–Ω–∏–∫–µ:

```sql
CREATE TABLE resources (
    resource_id INTEGER PRIMARY KEY AUTOINCREMENT,
    rate_code TEXT NOT NULL,           -- FK –∫ rates
    resource_code TEXT NOT NULL,       -- –ö–æ–¥ —Ä–µ—Å—É—Ä—Å–∞
    resource_type TEXT NOT NULL,       -- –¢–∏–ø (–ú–∞—Ç–µ—Ä–∏–∞–ª, –†–µ—Å—É—Ä—Å, –°–æ—Å—Ç–∞–≤ —Ä–∞–±–æ—Ç)
    resource_name TEXT NOT NULL,       -- –ù–∞–∑–≤–∞–Ω–∏–µ
    quantity NUMERIC DEFAULT 0,        -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
    unit TEXT NOT NULL,                -- –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
    unit_cost NUMERIC DEFAULT 0,       -- –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
    total_cost NUMERIC DEFAULT 0,      -- –ò—Ç–æ–≥–æ (quantity * unit_cost)

    -- P1 —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (machinery/labor):
    machinist_wage REAL DEFAULT 0,
    machinist_labor_hours REAL DEFAULT 0,
    machinist_machine_hours REAL DEFAULT 0,
    cost_without_wages REAL DEFAULT 0,
    relocation_included INTEGER DEFAULT 0,
    personnel_code TEXT,
    machinist_grade INTEGER,

    FOREIGN KEY (rate_code) REFERENCES rates(rate_code) ON DELETE CASCADE
);
```

#### 4. `resource_price_statistics` (–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–µ–Ω)
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ü–µ–Ω–∞–º —Ä–µ—Å—É—Ä—Å–æ–≤:

```sql
CREATE TABLE resource_price_statistics (
    price_stat_id INTEGER PRIMARY KEY AUTOINCREMENT,
    resource_code TEXT NOT NULL,
    rate_code TEXT NOT NULL,
    current_price_min REAL,
    current_price_max REAL,
    current_price_mean REAL,
    current_price_median REAL,
    unit_match INTEGER DEFAULT 0,
    material_resource_cost REAL,
    total_resource_cost REAL,

    UNIQUE(resource_code, rate_code)
);
```

#### 5. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (P2)
- `resource_mass` - –º–∞—Å—Å–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (3 –ø–æ–ª—è)
- `services` - —É—Å–ª—É–≥–∏ (6 –ø–æ–ª–µ–π)

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏

### 1. SearchEngine (`src/search/search_engine.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Ä–∞—Å—Ü–µ–Ω–æ–∫ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLite FTS5.

**–ö–ª–∞—Å—Å:** `SearchEngine(db_manager: DatabaseManager)`

**–ú–µ—Ç–æ–¥—ã:**

#### `search(query: str, filters: Dict = None, limit: int = 100) -> List[Dict]`
–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é —Ä–∞–±–æ—Ç.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (str) - —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–±–µ—Ç–æ–Ω –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π")
- `filters` (dict, optional) - —Ñ–∏–ª—å—Ç—Ä—ã:
  - `unit_type` (str) - –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è ("–º3", "–º2", "—Ç")
  - `min_cost` (float) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
  - `max_cost` (float) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
  - `category` (str) - –∫–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `limit` (int) - –º–∞–∫—Å. –∫–æ–ª-–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (default: 100, max: 1000)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `List[Dict]` —Å –ø–æ–ª—è–º–∏:
```python
{
    'rate_code': '–ì–≠–°–ù–ø10-05-001-01',
    'rate_full_name': '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫...',
    'rate_short_name': '–ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –ì–ö–õ',
    'unit_measure_full': '100 –º2',
    'cost_per_unit': 1383.20,
    'total_cost': 138320.26,
    'rank': -2.345  # FTS5 score (–±–ª–∏–∂–µ –∫ 0 = –ª—É—á—à–µ)
}
```

**–ü—Ä–∏–º–µ—Ä:**
```python
from src.database.db_manager import DatabaseManager
from src.search.search_engine import SearchEngine

db = DatabaseManager('data/processed/estimates.db')
search_engine = SearchEngine(db)

# –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
results = search_engine.search("–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω")

# –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
results = search_engine.search(
    "–±–µ—Ç–æ–Ω –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π",
    filters={'unit_type': '–º3', 'min_cost': 1000, 'max_cost': 50000},
    limit=50
)
```

#### `search_by_code(rate_code: str) -> List[Dict]`
–ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É —Ä–∞—Å—Ü–µ–Ω–∫–∏ (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `rate_code` (str) - –∫–æ–¥ –∏–ª–∏ –ø—Ä–µ—Ñ–∏–∫—Å –∫–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ì–≠–°–ù–ø81-01")

**–ü—Ä–∏–º–µ—Ä:**
```python
# –ù–∞–π—Ç–∏ –≤—Å–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "–ì–≠–°–ù–ø81-01"
results = search_engine.search_by_code("–ì–≠–°–ù–ø81-01")

# –ù–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ä–∞—Å—Ü–µ–Ω–∫—É
result = search_engine.search_by_code("–ì–≠–°–ù–ø81-01-001-01")
```

---

### 2. CostCalculator (`src/search/cost_calculator.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞—Å—á–µ—Ç —Ç–æ—á–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ —Ä–∞–±–æ—Ç —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º.

**–ö–ª–∞—Å—Å:** `CostCalculator(db_manager: DatabaseManager)`

**–ú–µ—Ç–æ–¥—ã:**

#### `calculate(rate_code: str, quantity: float) -> Dict`
–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `rate_code` (str) - –∫–æ–¥ —Ä–∞—Å—Ü–µ–Ω–∫–∏
- `quantity` (float) - –æ–±—ä–µ–º —Ä–∞–±–æ—Ç (>0, –≤ —Ç–µ—Ö –∂–µ –µ–¥–∏–Ω–∏—Ü–∞—Ö, —á—Ç–æ –∏ —Ä–∞—Å—Ü–µ–Ω–∫–∞)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Dict`:
```python
{
    'rate_info': {
        'rate_code': '–ì–≠–°–ù–ø10-05-001-01',
        'rate_full_name': '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫...',
        'unit_type': '–º2'
    },
    'base_cost': 138320.26,           # –°—Ç–æ–∏–º–æ—Å—Ç—å –∏–∑ –ë–î
    'cost_per_unit': 1383.20,         # –ó–∞ 1 –µ–¥–∏–Ω–∏—Ü—É
    'calculated_total': 207480.27,    # –ò—Ç–æ–≥–æ –¥–ª—è quantity
    'materials': 156341.85,           # –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
    'resources': 51138.42,            # –†–∞–±–æ—Ç–∞ + —Ç–µ—Ö–Ω–∏–∫–∞
    'quantity': 150
}
```

**–í–ê–ñ–ù–û:**
- –†–∞—Å—Ü–µ–Ω–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞ 100 –º2, –∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç 150 –º2
- `calculate()` —Å–∞–º –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç: `(138320.26 / 100) * 150 = 207480.27`
- –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º, –Ω–µ –¥–µ–ª–∏—Ç–µ –≤—Ä—É—á–Ω—É—é!

**–ü—Ä–∏–º–µ—Ä:**
```python
calculator = CostCalculator(db)

# –†–∞—Å—Ü–µ–Ω–∫–∞ –Ω–∞ 100 –º2, —Ä–∞—Å—á–µ—Ç –¥–ª—è 150 –º2
result = calculator.calculate("–ì–≠–°–ù–ø10-05-001-01", 150)
print(f"–°—Ç–æ–∏–º–æ—Å—Ç—å: {result['calculated_total']} —Ä—É–±.")
```

#### `get_detailed_breakdown(rate_code: str, quantity: float) -> Dict`
–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Ä–∞–∑–±–∏–≤–∫—É —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –í—Å–µ –ø–æ–ª—è –∏–∑ `calculate()` + `breakdown`:
```python
{
    # ... –≤—Å–µ –ø–æ–ª—è –∏–∑ calculate()
    'breakdown': [
        {
            'resource_code': '–ì–≠–°–ù101-1714',
            'resource_name': '–õ–∏—Å—Ç—ã –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω–Ω—ã–µ –ì–ö–õ 12.5 –º–º',
            'resource_type': '–ú–∞—Ç–µ—Ä–∏–∞–ª',
            'original_quantity': 202.0,     # –ò–∑ –ë–î
            'adjusted_quantity': 303.0,     # –ü–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–æ –¥–ª—è quantity
            'unit': '–º2',
            'unit_cost': 245.50,
            'adjusted_cost': 74386.50
        },
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
    ]
}
```

**–ü—Ä–∏–º–µ—Ä:**
```python
breakdown = calculator.get_detailed_breakdown("–ì–≠–°–ù–ø10-05-001-01", 150)

# –í—ã–≤–µ—Å—Ç–∏ –≤—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
materials = [r for r in breakdown['breakdown'] if '–ú–∞—Ç–µ—Ä–∏–∞–ª' in r['resource_type']]
for m in materials:
    print(f"{m['resource_name']}: {m['adjusted_quantity']} {m['unit']}")
```

---

### 3. RateComparator (`src/search/rate_comparator.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞—Å—Ü–µ–Ω–æ–∫ –º–µ–∂–¥—É —Å–æ–±–æ–π –∏ –ø–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤.

**–ö–ª–∞—Å—Å:** `RateComparator(db_path: str = 'data/processed/estimates.db')`

**–ú–µ—Ç–æ–¥—ã:**

#### `compare(rate_codes: List[str], quantity: float) -> pd.DataFrame`
–°—Ä–∞–≤–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Ü–µ–Ω–æ–∫.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `rate_codes` (List[str]) - –∫–æ–¥—ã —Ä–∞—Å—Ü–µ–Ω–æ–∫ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- `quantity` (float) - –æ–±—ä–µ–º —Ä–∞–±–æ—Ç –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ (>0)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `pd.DataFrame` —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
- `rate_code` - –∫–æ–¥ —Ä–∞—Å—Ü–µ–Ω–∫–∏
- `rate_full_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ
- `unit_type` - –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
- `cost_per_unit` - —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
- `total_for_quantity` - –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è quantity
- `materials_for_quantity` - –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è quantity
- `difference_from_cheapest` - —Ä–∞–∑–Ω–∏—Ü–∞ —Å –º–∏–Ω–∏–º—É–º–æ–º (—Ä—É–±.)
- `difference_percent` - —Ä–∞–∑–Ω–∏—Ü–∞ —Å –º–∏–Ω–∏–º—É–º–æ–º (%)

**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:** –ü–æ `total_for_quantity` (–æ—Ç –¥–µ—à–µ–≤–æ–≥–æ –∫ –¥–æ—Ä–æ–≥–æ–º—É)

**–ü—Ä–∏–º–µ—Ä:**
```python
comparator = RateComparator('data/processed/estimates.db')

df = comparator.compare(
    ['–ì–≠–°–ù–ø10-05-001-01', '–ì–≠–°–ù–ø10-06-037-02'],
    quantity=100
)

print(df[['rate_code', 'total_for_quantity', 'difference_percent']])
```

#### `find_alternatives(rate_code: str, max_results: int = 5) -> pd.DataFrame`
–ù–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏ —á–µ—Ä–µ–∑ FTS5.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `rate_code` (str) - –∏—Å—Ö–æ–¥–Ω–∞—è —Ä–∞—Å—Ü–µ–Ω–∫–∞
- `max_results` (int) - –º–∞–∫—Å. –∫–æ–ª-–≤–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤ (default: 5)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `pd.DataFrame` —Å —Ç–æ–π –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, —á—Ç–æ `compare()`
–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –∏—Å—Ö–æ–¥–Ω–∞—è —Ä–∞—Å—Ü–µ–Ω–∫–∞ (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)

**–ü—Ä–∏–º–µ—Ä:**
```python
alternatives = comparator.find_alternatives("–ì–≠–°–ù–ø10-05-001-01", max_results=5)

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–±–µ–∑ –∏—Å—Ö–æ–¥–Ω–æ–π)
alternatives_only = alternatives.iloc[1:]
print(alternatives_only[['rate_code', 'rate_full_name', 'difference_percent']])
```

---

### 4. AgentHelpers (`src/utils/agent_helpers.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±–µ—Ä—Ç–∫–∏ –Ω–∞–¥ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏ —Å Rich-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞.

**–§—É–Ω–∫—Ü–∏–∏:**

#### `natural_search(query, filters=None, limit=10, db_path='...')`
–ü–æ–∏—Å–∫ —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
{
    'results': [...],           # –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    'formatted_text': str,      # Rich —Ç–∞–±–ª–∏—Ü–∞ (–≥–æ—Ç–æ–≤–∞—è –∫ –≤—ã–≤–æ–¥—É)
    'query_info': {
        'query': str,
        'result_count': int
    }
}
```

#### `quick_calculate(rate_code_or_description, quantity, db_path='...')`
–£–º–Ω—ã–π —Ä–∞—Å—á–µ—Ç: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–¥ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ.

```python
# –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –∫–æ–¥ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ
result = quick_calculate("–ì–≠–°–ù–ø10-05-001-01", 150)

# –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ - —Å–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç, –ø–æ—Ç–æ–º —Å—á–∏—Ç–∞–µ—Ç
result = quick_calculate("–±–µ—Ç–æ–Ω –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π B25", 50)
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
{
    'calculation': {...},       # –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞
    'formatted_text': str,      # Rich –ø–∞–Ω–µ–ª—å —Å —Ä–∞—Å—á–µ—Ç–æ–º
    'rate_used': str,           # –ö–æ–¥ —Ä–∞—Å—Ü–µ–Ω–∫–∏
    'search_performed': bool    # –ë—ã–ª –ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–∏—Å–∫
}
```

#### `show_rate_details(rate_code, db_path='...')`
–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞—Å—Ü–µ–Ω–∫–µ —Å —Ç–∞–±–ª–∏—Ü–µ–π —Ä–µ—Å—É—Ä—Å–æ–≤.

#### `compare_variants(descriptions: List[str], quantity, db_path='...')`
–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—è–º (–∞–≤—Ç–æ–ø–æ–∏—Å–∫).

#### `find_similar_rates(rate_code, max_results=5, db_path='...')`
–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ä–∞—Å—Ü–µ–Ω–æ–∫ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `formatted_text` - –≥–æ—Ç–æ–≤—ã–π Rich-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à –∑–∞–ø—Ä–æ—Å–æ–≤ (TTL: 24 —á–∞—Å–∞, `data/cache/query_cache.json`)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 agent_helpers.py                    ‚îÇ
‚îÇ            (High-level API –¥–ª—è –∞–≥–µ–Ω—Ç–∞)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îú‚îÄ‚îÄ‚ñ∫ SearchEngine ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îú‚îÄ‚îÄ‚ñ∫ CostCalculator ‚îÄ‚îÄ‚î§
                  ‚îî‚îÄ‚îÄ‚ñ∫ RateComparator ‚îÄ‚îÄ‚î§
                                        ‚îÇ
                                        ‚ñº
                                 DatabaseManager
                                        ‚îÇ
                                        ‚ñº
                                 estimates.db
                                 (SQLite + FTS5)
```

**–ò–µ—Ä–∞—Ä—Ö–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤:**
1. **–£—Ä–æ–≤–µ–Ω—å 1:** `db_manager.py` - –±–∞–∑–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ë–î
2. **–£—Ä–æ–≤–µ–Ω—å 2:** `search_engine.py`, `cost_calculator.py`, `rate_comparator.py` - –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏
3. **–£—Ä–æ–≤–µ–Ω—å 3:** `agent_helpers.py` - –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞

**–ü—Ä–∞–≤–∏–ª–æ:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ `agent_helpers.py` –≤ —Ç–µ—Å—Ç–∞—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π.

---

## –¢–∏–ø–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–∏—Å–∫ –∏ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏

```python
from src.database.db_manager import DatabaseManager
from src.search.search_engine import SearchEngine
from src.search.cost_calculator import CostCalculator

# 1. –û—Ç–∫—Ä—ã—Ç—å –ë–î
db = DatabaseManager('data/processed/estimates.db')

# 2. –ù–∞–π—Ç–∏ —Ä–∞—Å—Ü–µ–Ω–∫—É
search_engine = SearchEngine(db)
results = search_engine.search("–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω –æ–¥–∏–Ω —Å–ª–æ–π")

if results:
    rate_code = results[0]['rate_code']

    # 3. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å
    calculator = CostCalculator(db)
    cost = calculator.calculate(rate_code, 150)

    print(f"–°—Ç–æ–∏–º–æ—Å—Ç—å: {cost['calculated_total']} —Ä—É–±.")
    print(f"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã: {cost['materials']} —Ä—É–±.")
    print(f"–†–∞–±–æ—Ç–∞: {cost['resources']} —Ä—É–±.")
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

```python
from src.search.search_engine import SearchEngine
from src.search.rate_comparator import RateComparator

# 1. –ù–∞–π—Ç–∏ —Ä–∞—Å—Ü–µ–Ω–∫–∏ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
search = SearchEngine(db)
single_layer = search.search("–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω –æ–¥–∏–Ω —Å–ª–æ–π")[0]
double_layer = search.search("–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω –¥–≤–∞ —Å–ª–æ—è")[0]

# 2. –°—Ä–∞–≤–Ω–∏—Ç—å
comparator = RateComparator('data/processed/estimates.db')
df = comparator.compare(
    [single_layer['rate_code'], double_layer['rate_code']],
    quantity=100
)

# 3. –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
for idx, row in df.iterrows():
    print(f"{row['rate_full_name']}: {row['total_for_quantity']} —Ä—É–±. "
          f"(+{row['difference_percent']}%)")
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞

```python
calculator = CostCalculator(db)
breakdown = calculator.get_detailed_breakdown("–ì–≠–°–ù–ø10-05-001-01", 100)

# –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º
materials = [r for r in breakdown['breakdown'] if '–ú–∞—Ç–µ—Ä–∏–∞–ª' in r['resource_type']]
labor = [r for r in breakdown['breakdown'] if '–†–∞–±–æ—Ç–∞' in r['resource_type']]

print(f"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã ({len(materials)} –ø–æ–∑–∏—Ü–∏–π):")
for m in materials:
    print(f"  {m['resource_name']}: {m['adjusted_quantity']} {m['unit']} "
          f"x {m['unit_cost']} = {m['adjusted_cost']} —Ä—É–±.")
```

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ë–î:**
```bash
ls -lh data/processed/estimates.db
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ~290 MB
```

**2. –ï—Å–ª–∏ –ë–î –Ω–µ—Ç - —Å–æ–±—Ä–∞—Ç—å –∏–∑ Excel:**
```bash
python scripts/build_database.py
```

–ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏:
1. –ß–∏—Ç–∞–µ—Ç Excel —Ñ–∞–π–ª—ã –∏–∑ `data/raw/`
2. –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `DataAggregator`
3. –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ë–î —á–µ—Ä–µ–∑ `DatabasePopulator`
4. –°–æ–∑–¥–∞–µ—Ç FTS5 –∏–Ω–¥–µ–∫—Å—ã
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `data/processed/estimates.db`

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5-10 –º–∏–Ω—É—Ç
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** pandas, openpyxl, sqlite3

### –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ –∞–≥–µ–Ω—Ç–∞

**1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Claude Code Agent:**
```bash
claude-code
```

**2. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `data/processed/estimates.db`
- –ï—Å–ª–∏ –ë–î –Ω–µ—Ç - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å `build_database.py`
- –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ë–î - –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ

**3. –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å 150 –º¬≤ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ –∏–∑ –ì–ö–õ?

–ê–≥–µ–Ω—Ç:
1. search_engine.search("–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω")
2. calculator.calculate(–Ω–∞–π–¥–µ–Ω–Ω—ã–π_–∫–æ–¥, 150)
3. –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
```

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°—Ä–∞–≤–Ω–∏ –æ–¥–Ω–æ—Å–ª–æ–π–Ω—ã–µ –∏ –¥–≤—É—Ö—Å–ª–æ–π–Ω—ã–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏

–ê–≥–µ–Ω—Ç:
1. search_engine.search("–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –æ–¥–Ω–æ—Å–ª–æ–π–Ω—ã–µ")
2. search_engine.search("–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –¥–≤—É—Ö—Å–ª–æ–π–Ω—ã–µ")
3. comparator.compare([–∫–æ–¥1, –∫–æ–¥2], quantity)
4. –í—ã–≤–æ–¥ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ–∂–∏–¥–∞–µ–º—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á–µ—Ç

**–ó–∞–ø—Ä–æ—Å:**
"–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 150 –º¬≤ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ –∏–∑ –ì–ö–õ –≤ –æ–¥–∏–Ω —Å–ª–æ–π?"

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```
–°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ 150 –º¬≤ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ –∏–∑ –ì–ö–õ –≤ –æ–¥–∏–Ω —Å–ª–æ–π —Å–æ—Å—Ç–∞–≤–∏—Ç **207,480.27 —Ä—É–±.**

## –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç

**–†–∞—Å—Ü–µ–Ω–∫–∞:** –ì–≠–°–ù–ø10-05-001-01
**–ù–∞–∑–≤–∞–Ω–∏–µ:** –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ –∏–∑ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤ –≤ –æ–¥–∏–Ω —Å–ª–æ–π –Ω–∞ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–æ–º –∫–∞—Ä–∫–∞—Å–µ
**–û–±—ä—ë–º —Ä–∞–±–æ—Ç:** 150 –º¬≤

**–ò–¢–û–ì–û: 207,480.27 —Ä—É–±.**

–ò–∑ –Ω–∏—Ö:
- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã: 156,341.85 —Ä—É–±. (75.3%)
- –†–∞–±–æ—Ç–∞ + —Ç–µ—Ö–Ω–∏–∫–∞: 51,138.42 —Ä—É–±. (24.7%)

**–ö–∞–∫ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ:**
- –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—Ü–µ–Ω–∫–∏: 138,320.26 —Ä—É–±. (–Ω–∞ 100 –º¬≤)
- –°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ 1 –º¬≤: 1,383.20 —Ä—É–±.
- –î–ª—è 150 –º¬≤: 1,383.20 √ó 150 = **207,480.27 —Ä—É–±.**
```

### –ü—Ä–∏–º–µ—Ä 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

**–ó–∞–ø—Ä–æ—Å:**
"–°—Ä–∞–≤–Ω–∏ –æ–¥–Ω–æ—Å–ª–æ–π–Ω—ã–µ –∏ –¥–≤—É—Ö—Å–ª–æ–π–Ω—ã–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –¥–ª—è 100 –º¬≤"

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```
## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞—Å—Ü–µ–Ω–æ–∫ –Ω–∞ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏

–î–ª—è –æ–±—ä—ë–º–∞ **100 –º¬≤**:

| –¢–∏–ø –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ | –ö–æ–¥ —Ä–∞—Å—Ü–µ–Ω–∫–∏ | –°—Ç–æ–∏–º–æ—Å—Ç—å | –†–∞–∑–Ω–∏—Ü–∞ |
|-----------------|--------------|-----------|---------|
| **–û–¥–Ω–æ—Å–ª–æ–π–Ω—ã–µ** | –ì–≠–°–ù–ø10-05-001-01 | 138,320.26 —Ä—É–±. | ‚Äî |
| **–î–≤—É—Ö—Å–ª–æ–π–Ω—ã–µ** | –ì–≠–°–ù–ø10-06-037-02 | 185,760.35 —Ä—É–±. | +47,440.09 —Ä—É–±. (+34.3%) |

### –í—ã–≤–æ–¥—ã:

‚úÖ **–û–¥–Ω–æ—Å–ª–æ–π–Ω—ã–µ** - –¥–µ—à–µ–≤–ª–µ –Ω–∞ 34.3%
- –¢–æ–ª—â–∏–Ω–∞: 12.5 –º–º
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è: –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–µ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫

‚úÖ **–î–≤—É—Ö—Å–ª–æ–π–Ω—ã–µ** - –¥–æ—Ä–æ–∂–µ, –Ω–æ –ø—Ä–æ—á–Ω–µ–µ
- –¢–æ–ª—â–∏–Ω–∞: 25 –º–º
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: –ª—É—á—à–∞—è –∑–≤—É–∫–æ–∏–∑–æ–ª—è—Ü–∏—è, –≤—ã—à–µ –ø—Ä–æ—á–Ω–æ—Å—Ç—å
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤

**–ó–∞–ø—Ä–æ—Å:**
"–ù–∞–π–¥–∏ –±–æ–ª–µ–µ –¥–µ—à—ë–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –ì–≠–°–ù–ø10-05-001-01"

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```
## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏

–ò—Å—Ö–æ–¥–Ω–∞—è —Ä–∞—Å—Ü–µ–Ω–∫–∞: –ì–≠–°–ù–ø10-05-001-01 (138,320.26 —Ä—É–±.)

–ù–∞–π–¥–µ–Ω—ã –ø–æ—Ö–æ–∂–∏–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏:

| –ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ | –°—Ç–æ–∏–º–æ—Å—Ç—å | –†–∞–∑–Ω–∏—Ü–∞ |
|-----|----------|-----------|---------|
| –ì–≠–°–ù–ø10-05-002-01 | –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –æ–±–ª–µ–≥—á–µ–Ω–Ω—ã–µ | 125,450.18 —Ä—É–±. | **-9.3%** ‚≠ê |
| –ì–≠–°–ù–ø10-05-003-01 | –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç | 138,320.26 —Ä—É–±. | 0% |
| –ì–≠–°–ù–ø10-06-037-02 | –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ —É—Å–∏–ª–µ–Ω–Ω—ã–µ | 185,760.35 —Ä—É–±. | +34.3% |

‚≠ê –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ì–≠–°–ù–ø10-05-002-01 –¥–µ—à–µ–≤–ª–µ –Ω–∞ 12,870.08 —Ä—É–±. (9.3%)
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ

**–ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∞–≥–µ–Ω—Ç–∞:**

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ë–î:**
```python
import os
db_exists = os.path.exists('data/processed/estimates.db')
if not db_exists:
    print("‚ö†Ô∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!")
    print("–ó–∞–ø—É—Å—Ç–∏—Ç–µ: python scripts/build_database.py")
    exit()
```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ë–î:**
```python
db_size = os.path.getsize('data/processed/estimates.db')
if db_size < 100_000_000:  # < 100 MB
    print("‚ö†Ô∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∞—è, –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞")
```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–æ–¥—É–ª–µ–π:**
```python
try:
    from src.search.search_engine import SearchEngine
    from src.search.cost_calculator import CostCalculator
    from src.search.rate_comparator import RateComparator
    print("‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã")
except ImportError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
```

4. **–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:**
```python
from src.database.db_manager import DatabaseManager
from src.search.search_engine import SearchEngine

db = DatabaseManager('data/processed/estimates.db')
search = SearchEngine(db)
results = search.search("–±–µ—Ç–æ–Ω", limit=1)

if results:
    print(f"‚úÖ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç: –Ω–∞–π–¥–µ–Ω–∞ —Ä–∞—Å—Ü–µ–Ω–∫–∞ {results[0]['rate_code']}")
else:
    print("‚ö†Ô∏è –ë–î –ø—É—Å—Ç–∞—è –∏–ª–∏ –ø–æ–∏—Å–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç")
```

---

## –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞—Å—Ü–µ–Ω–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å —Ä–∞–∑–Ω—ã–º–∏ unit_quantity:
- –†–∞—Å—Ü–µ–Ω–∫–∞ A: `unit_quantity=100, unit_type='–º2'` ‚Üí "–Ω–∞ 100 –º2"
- –†–∞—Å—Ü–µ–Ω–∫–∞ B: `unit_quantity=1, unit_type='–º3'` ‚Üí "–Ω–∞ 1 –º3"

**–†–µ—à–µ–Ω–∏–µ:** `CostCalculator` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç:
```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç 150 –º2
# –†–∞—Å—Ü–µ–Ω–∫–∞ –≤ –ë–î: unit_quantity=100, total_cost=138320.26
calculator.calculate(rate_code, 150)
# –í–Ω—É—Ç—Ä–∏: (138320.26 / 100) * 150 = 207480.27
```

**–ü—Ä–∞–≤–∏–ª–æ:** –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –≤ `calculate()`, –Ω–µ –¥–µ–ª–∏—Ç–µ –≤—Ä—É—á–Ω—É—é!

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

`agent_helpers.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON-–∫—ç—à:
- –ü—É—Ç—å: `data/cache/query_cache.json`
- TTL: 24 —á–∞—Å–∞
- –ö–ª—é—á: `f"search:{query}:{filters}:{limit}"`

**–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞:**
```bash
rm data/cache/query_cache.json
```

### 3. FTS5 Query Syntax

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã:
- `–±–µ—Ç–æ–Ω –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π` - –æ–±–∞ —Å–ª–æ–≤–∞
- `"–º–æ–Ω—Ç–∞–∂ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π"` - —Ç–æ—á–Ω–∞—è —Ñ—Ä–∞–∑–∞
- `–±–µ—Ç–æ–Ω OR –∂–µ–ª–µ–∑–æ–±–µ—Ç–æ–Ω` - –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò–õ–ò
- `–±–µ—Ç–æ–Ω NOT –º–æ–Ω—Ç–∞–∂` - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
- `rate_full_name: –∑–µ–º–ª—è–Ω—ã–µ` - –ø–æ–∏—Å–∫ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø–æ–ª–µ

### 4. –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ –∏–µ—Ä–∞—Ä—Ö–∏—é:
```sql
-- –í—Å–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏ –∏–∑ —Å–±–æ—Ä–Ω–∏–∫–∞ –ì–≠–°–ù–ø81
SELECT * FROM rates WHERE collection_code = '–ì–≠–°–ù–ø81';

-- Drill-down –ø–æ —É—Ä–æ–≤–Ω—è–º
SELECT
    collection_name,
    department_name,
    section_name,
    COUNT(*) as rate_count
FROM rates
WHERE collection_code = '–ì–≠–°–ù–ø81'
GROUP BY collection_name, department_name, section_name;
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–ø–∏—Å–∞–Ω–∞ –≤ `docs/estimates_search_architecture.md`

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**

1. **Separation of Concerns:**
   - `database/` - —Ä–∞–±–æ—Ç–∞ —Å –ë–î
   - `search/` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞/—Ä–∞—Å—á–µ—Ç–æ–≤
   - `utils/` - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
   - `etl/` - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

2. **Single Responsibility:**
   - `SearchEngine` - —Ç–æ–ª—å–∫–æ –ø–æ–∏—Å–∫
   - `CostCalculator` - —Ç–æ–ª—å–∫–æ —Ä–∞—Å—á–µ—Ç—ã
   - `RateComparator` - —Ç–æ–ª—å–∫–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

3. **Dependency Injection:**
   - –í—Å–µ –º–æ–¥—É–ª–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç `DatabaseManager` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
   - –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å mock –ë–î

4. **Error Handling:**
   - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - `ValueError` –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - `sqlite3.Error` –¥–ª—è –æ—à–∏–±–æ–∫ –ë–î
   - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

## –î–ª—è Claude Code Agent

**–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç-—Å–º–µ—Ç—á–∏–∫** —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —ç—Ç–∏–º –º–æ–¥—É–ª—è–º. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ:

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –º–æ–¥—É–ª–∏** - –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Ü–∏—Ñ—Ä—ã
2. **–ü—Ä–æ–≤–µ—Ä—è–π –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è** - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏
3. **–ü–æ—è—Å–Ω–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** - –ø–æ–∫–∞–∂–∏ –æ—Ç–∫—É–¥–∞ –≤–∑—è–ª–∏—Å—å —Ü–∏—Ñ—Ä—ã
4. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –æ—Ç–≤–µ—Ç** - –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç ‚Üí –¥–µ—Ç–∞–ª–∏ ‚Üí –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
5. **–ò—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ç–∞–±–ª–∏—Ü—ã, —Å–ø–∏—Å–∫–∏, –≤—ã–¥–µ–ª–µ–Ω–∏—è
6. **–ü—Ä–∏ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏ - —Å–ø—Ä–∞—à–∏–≤–∞–π** - –ª—É—á—à–µ —É—Ç–æ—á–Ω–∏—Ç—å
7. **–ü—Ä–µ–¥–ª–∞–≥–∞–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã** - –ø–æ–∫–∞–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ—à–µ–≤–ª–µ/–¥–æ—Ä–æ–∂–µ

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–≥–µ–Ω—Ç–∞:** –°–º. `agents/estimates_agent_prompt.md` (620 —Å—Ç—Ä–æ–∫ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏)

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:**
```bash
pytest tests/
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤:**
- `tests/test_search_engine.py` - SearchEngine
- `tests/test_cost_calculator.py` - CostCalculator
- `tests/test_rate_comparator.py` - RateComparator
- `tests/test_integration.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**Coverage:**
```bash
pytest --cov=src tests/
```

---

## –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ –ë–î (rates, resources, FTS5)
- ‚úÖ SearchEngine —Å FTS5
- ‚úÖ CostCalculator —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ RateComparator —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏
- ‚úÖ AgentHelpers —Å Rich —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ì–≠–°–ù/–§–ï–† –∏–µ—Ä–∞—Ä—Ö–∏—è (13 –ø–æ–ª–µ–π)
- ‚úÖ P1 —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (overhead, profit, machinery)
- ‚úÖ P2 –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (resource_mass, services)

**–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- üü° –ó–∞–¥–∞—á–∞ 4.3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Claude Code Agent (—Ç–µ–∫—É—â–∞—è)
- ‚è≥ –ó–∞–¥–∞—á–∏ 5.x: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚è≥ –ó–∞–¥–∞—á–∏ 6.x: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `docs/tasks/active-tasks.md`

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** [–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–µ–∫—Ç]
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/`
**–ü—Ä–æ–º–ø—Ç –∞–≥–µ–Ω—Ç–∞:** `agents/estimates_agent_prompt.md`
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** `docs/estimates_search_architecture.md`

**–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `data/processed/estimates.db` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~290 MB)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å `python scripts/build_database.py` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ (logging.INFO)
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å `pytest tests/` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥—É–ª–µ–π
